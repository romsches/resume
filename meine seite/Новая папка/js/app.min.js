/*! by @vlucendo -- http://vlucendo.com */
!function(s){function e(e){for(var t,i,n=e[0],r=e[1],o=e[2],a=0,l=[];a<n.length;a++)i=n[a],u[i]&&l.push(u[i][0]),u[i]=0;for(t in r)Object.prototype.hasOwnProperty.call(r,t)&&(s[t]=r[t]);for(f&&f(e);l.length;)l.shift()();return v.push.apply(v,o||[]),c()}function c(){for(var e,t=0;t<v.length;t++){for(var i=v[t],n=!0,r=1;r<i.length;r++){var o=i[r];0!==u[o]&&(n=!1)}n&&(v.splice(t--,1),e=a(a.s=i[0]))}return e}var i={},u={0:0},v=[];function a(e){if(i[e])return i[e].exports;var t=i[e]={i:e,l:!1,exports:{}};return s[e].call(t.exports,t,t.exports,a),t.l=!0,t.exports}a.m=s,a.c=i,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(i,n,function(e){return t[e]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var t=window.webpackJsonp=window.webpackJsonp||[],n=t.push.bind(t);t.push=e,t=t.slice();for(var r=0;r<t.length;r++)e(t[r]);var f=n;v.push([37,1]),c()}([,,function(e,t){e.exports="precision highp float;\nprecision highp int;\nattribute vec2 uv;\nattribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\n\nvarying vec2 vUv;\n\nvoid main()\n{\n    vUv = uv;\n    gl_Position = vec4(position, 1.0);\n}\n"},,,,,,,function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float aspectRatio;\nuniform float iCellSize;\nuniform sampler2D velocity;\nuniform sampler2D target;\nuniform float timeStep;\nuniform float dissipation;\n\nvarying vec2 vUv;\n\nvec2 texelToSimSpace(vec2 texSpace) {\n    vec2 clipSpace = 2.0 * texSpace - 1.0;\n    return vec2(clipSpace.x * aspectRatio, clipSpace.y);\n}\n\nvec2 simToTexelSpace(vec2 simSpace) {\n    return vec2(simSpace.x / aspectRatio + 1.0, simSpace.y + 1.0) * 0.5;\n}\n\nvoid main(void)\n{\n    vec2 pos = texelToSimSpace(vUv) - timeStep * iCellSize * texture2D(velocity, vUv).xy;\n    pos = simToTexelSpace(pos) / texelSize;\n\n    vec4 st;\n    st.xy = floor(pos - 0.5) + 0.5;\n    st.zw = st.xy + 1.0;\n\n    vec2 t = pos - st.xy;\n\n    st *= texelSize.xyxy;\n\n    vec4 tex11 = texture2D(target, st.xy);\n    vec4 tex21 = texture2D(target, st.zy);\n    vec4 tex12 = texture2D(target, st.xw);\n    vec4 tex22 = texture2D(target, st.zw);\n\n    gl_FragColor = mix(mix(tex11, tex21, t.x), mix(tex12, tex22, t.x), t.y) * dissipation;\n}\n"},,,,,,,,function(e,t){e.exports=function(e){return'<canvas></canvas>\x3c!--<div class="info"></div>--\x3e'}},,,function(e,t){e.exports="precision highp float;\nprecision highp int;\nattribute vec2 uv;\nattribute vec3 position;\nattribute vec3 normal;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\n\n\nvarying vec2 vUv;\n\nvoid main()\n{\n    vUv = uv;\n    gl_Position = vec4(position, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform sampler2D tFluid;\nuniform vec3 colorBg;\nuniform vec3 colorDye;\n\nvarying vec2 vUv;\n\nvoid main()\n{\n    vec3 c = mix(colorBg, colorDye, texture2D(tFluid, vUv).r);\n    gl_FragColor = vec4(c, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float aspectRatio;\nuniform sampler2D velocity;\nuniform float timeStep;\nuniform float mouseSize;\nuniform float velMultiplier;\nuniform float cellSize;\nuniform vec2 mousePosition;\nuniform vec2 lastMousePosition;\n\nvarying vec2 vUv;\n\nvec2 texelToSimSpace(vec2 texSpace) {\n    vec2 clipSpace = 2.0 * texSpace - 1.0;\n    return vec2(clipSpace.x * aspectRatio, clipSpace.y);\n}\n\nvec2 clipToSimSpace(vec2 clipSpace) {\n    return  vec2(clipSpace.x * aspectRatio, clipSpace.y);\n}\n\nfloat distanceToSegment(vec2 a, vec2 b, vec2 p, out float fp) {\n    vec2 d = p - a;\n    vec2 x = b - a;\n    fp = 0.0;\n    float lx = length(x);\n    if(lx <= 0.0001) return length(d);\n    float projection = dot(d, x / lx);\n    fp = projection / lx;\n    if(projection < 0.0)            return length(d);\n    else if(projection > length(x)) return length(p - b);\n    return sqrt(abs(dot(d, d) - projection*projection));\n}\nfloat distanceToSegment(vec2 a, vec2 b, vec2 p) {\n    float fp;\n    return distanceToSegment(a, b, p, fp);\n}\n\nfloat line(vec2 uv, vec2 point1, vec2 point2, float size)\n{\n    vec2 pa = uv - point1, ba = point2 - point1;\n    float h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);\n    return 1.0 - step(size, length(pa - ba * h));\n}\n\nfloat circle(vec2 uv, vec2 position, float radius)\n{\n    return 1.0 - step(radius, length(uv - position));\n}\n\nvoid main()\n{\n    vec2 v = texture2D(velocity, vUv).xy;\n    vec2 mouse = clipToSimSpace(mousePosition);\n    vec2 lastMouse = clipToSimSpace(lastMousePosition);\n    vec2 p = texelToSimSpace(vUv);\n    vec2 mouseVelocity = (mouse - lastMouse) / (timeStep * velMultiplier);\n    float ll = length(mouse - lastMouse);\n    float l = line(p, lastMouse, mouse, clamp(mouseSize * ll * 7.5, 0.0, mouseSize * 1.5)) * (1.0 - circle(p, lastMouse, clamp(mouseSize * ll * 7.5, 0.0, mouseSize * 1.5)));\n    v += mouseVelocity * l * cellSize;\n    gl_FragColor = vec4(v, 0.0, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float aspectRatio;\nuniform float hICellSize;\nuniform sampler2D velocity;\n\nvarying vec2 vUv;\n\nfloat when_gt(float x, float y) {\n    return max(sign(x - y), 0.0);\n}\nfloat when_lt(float x, float y) {\n    return max(sign(y - x), 0.0);\n}\n\nvec2 sampleVelocity(sampler2D velocity, vec2 coord) {\n\n    vec2 multiplier = vec2(1.0, 1.0);\n\n    multiplier.x = mix(-1.0, multiplier.x, when_lt(0.0, coord.x));\n    multiplier.x = mix(-1.0, multiplier.x, when_gt(1.0, coord.x));\n    multiplier.y = mix(-1.0, multiplier.y, when_lt(0.0, coord.y));\n    multiplier.y = mix(-1.0, multiplier.y, when_gt(1.0, coord.y));\n\n    return multiplier * texture2D(velocity, coord).xy;\n}\n\nvoid main(void) {\n    vec2 L = sampleVelocity(velocity, vUv - vec2(texelSize.x, 0.0));\n    vec2 R = sampleVelocity(velocity, vUv + vec2(texelSize.x, 0.0));\n    vec2 B = sampleVelocity(velocity, vUv - vec2(0.0, texelSize.y));\n    vec2 T = sampleVelocity(velocity, vUv + vec2(0.0, texelSize.y));\n    gl_FragColor = vec4(hICellSize * ((R.x - L.x) + (T.y - B.y)), 0.0, 0.0, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float aspectRatio;\nuniform float alpha;\n\nuniform sampler2D pressure;\nuniform sampler2D divergence;\n\nvarying vec2 vUv;\n\nvoid main(void) {\n    float L = texture2D(pressure, vUv - vec2(texelSize.x, 0.0)).x;\n    float R = texture2D(pressure, vUv + vec2(texelSize.x, 0.0)).x;\n    float B = texture2D(pressure, vUv - vec2(0, texelSize.y)).x;\n    float T = texture2D(pressure, vUv + vec2(0, texelSize.y)).x;\n    float bC = texture2D(divergence, vUv).x;\n    gl_FragColor = vec4((L + R + B + T + alpha * bC) * 0.25, 0.0, 0.0, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float aspectRatio;\nuniform float iCellSize;\n\nuniform sampler2D pressure;\nuniform sampler2D velocity;\n\nvarying vec2 vUv;\n\nvoid main(void) {\n    float L = texture2D(pressure, vUv - vec2(texelSize.x, 0.0)).x;\n    float R = texture2D(pressure, vUv + vec2(texelSize.x, 0.0)).x;\n    float B = texture2D(pressure, vUv - vec2(0.0, texelSize.y)).x;\n    float T = texture2D(pressure, vUv + vec2(0.0, texelSize.y)).x;\n    vec2 v = texture2D(velocity, vUv).xy;\n    gl_FragColor = vec4(v - iCellSize * vec2(R-L, T-B), 0.0, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform sampler2D velocity;\n\nvarying vec2 vUv;\n\nfloat curl2D(vec2 p)\n{\n    float dudy = texture2D(velocity, p + vec2(0.0, texelSize.y)).x - texture2D(velocity, p - vec2(0.0, texelSize.y)).x;\n    float dvdx = texture2D(velocity, p + vec2(texelSize.x, 0.0)).y - texture2D(velocity, p - vec2(texelSize.x, 0.0)).y;\n\n    return (dudy - dvdx) * 0.5;\n}\n\nvoid main()\n{\n    float edge = (1.0 - step(1.0 - texelSize.x * 2.0, abs(vUv.x - 0.5) * 2.0))\n               * (1.0 - step(1.0 - texelSize.y * 2.0, abs(vUv.y - 0.5) * 2.0));\n\n    float curl = curl2D(vUv);\n    float curlLength = abs(curl);\n\n    gl_FragColor = vec4(curl * edge, curlLength * edge, 0.0, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float vorticityScale;\nuniform sampler2D velocity;\nuniform sampler2D curl;\n\nvarying vec2 vUv;\n\nvoid main()\n{\n    float dwdx = (texture2D(curl, vUv + vec2(texelSize.x, 0.0)).x - texture2D(curl, vUv - vec2(texelSize.x, 0.0)).x) * 0.5;\n    float dwdy = (texture2D(curl, vUv + vec2(0.0, texelSize.y)).x - texture2D(curl, vUv - vec2(0.0, texelSize.y)).x) * 0.5;\n\n    float lngthSq = dwdx * dwdx + dwdy * dwdy;\n    float lngth = sqrt(lngthSq) + 0.000001;\n    lngth = 1.0 / lngth;\n    dwdx *= lngth;\n    dwdy *= lngth;\n    float v = texture2D(curl, vUv).y;\n    vec2 outVel = texture2D(velocity, vUv).xy + vorticityScale * vec2(dwdy * -v, dwdx * v);\n\n    float edge = (1.0 - step(1.0 - texelSize.x * 2.0, abs(vUv.x - 0.5) * 2.0))\n               * (1.0 - step(1.0 - texelSize.y * 2.0, abs(vUv.y - 0.5) * 2.0));\n\n    outVel *= edge;\n\n    gl_FragColor = vec4(outVel.x, outVel.y, 0.0, 1.0);\n}\n"},function(e,t){e.exports="precision highp float;\nprecision highp int;\nuniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n\n\nuniform vec2 texelSize;\nuniform float aspectRatio;\nuniform sampler2D dye;\nuniform float timeStep;\nuniform float mouseSize;\nuniform float cellSize;\nuniform vec2 mousePosition;\nuniform vec2 lastMousePosition;\n\nvarying vec2 vUv;\n\nvec2 texelToSimSpace(vec2 texSpace) {\n    vec2 clipSpace = 2.0 * texSpace - 1.0;\n    return vec2(clipSpace.x * aspectRatio, clipSpace.y);\n}\n\nvec2 clipToSimSpace(vec2 clipSpace) {\n    return  vec2(clipSpace.x * aspectRatio, clipSpace.y);\n}\n\n\nfloat line(vec2 uv, vec2 point1, vec2 point2, float size)\n{\n    vec2 pa = uv - point1, ba = point2 - point1;\n    float h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);\n    return 1.0 - step(size, length(pa - ba * h));\n}\n\nfloat circle(vec2 uv, vec2 position, float radius)\n{\n    return 1.0 - step(radius, length(uv - position));\n}\n\nvoid main()\n{\n    float dye = texture2D(dye, vUv).r;\n    vec2 mouse = clipToSimSpace(mousePosition);\n    vec2 lastMouse = clipToSimSpace(lastMousePosition);\n    vec2 p = texelToSimSpace(vUv);\n    float mouseVelocity = length(mouse - lastMouse);\n    float l = line(p, lastMouse, mouse, clamp(mouseSize * mouseVelocity * 7.5, 0.0, mouseSize * 1.5));\n\n    dye = clamp(dye + l, 0.0, 1.0);\n    gl_FragColor = vec4(dye, 0.0, 0.0, 1.0);\n}\n"},,,,,,function(e,t,i){},,function(e,t,i){},function(e,t,i){"use strict";i.r(t);var r=i(4),a=(i(34),i(0)),o=i(16),l=i(8),s=(i(35),i(29)),c={main:null,rootUrl:null,appData:null,client:{browser:"",device:"",lang:"",os:"",sizes:{width:window.innerWidth,height:window.innerHeight},mousePosition:{x:0,y:0}}},n=i(17),u=i.n(n),v=(i(36),i(30)),f=i(5),m=i(20),p=i.n(m),h=i(21),d=i.n(h);var x=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mainUniforms=t,this.material=new a.n({uniforms:{tFluid:{value:null},colorBg:{value:new a.b(this.mainUniforms.colorBg)},colorDye:{value:new a.b(this.mainUniforms.colorDye)}},vertexShader:p.a,fragmentShader:d.a}),this.material.depthWrite=!1,this.material.depthTest=!1,this.pass=new f.a(this.material),this.pass.setSize=function(e,t){},this.pass.needsSwap=!1,this.pass.renderToScreen=!0},y=i(2),S=i.n(y),g=i(9),z=i.n(g),M=i(22),w=i.n(M),b=i(23),R=i.n(b),D=i(24),U=i.n(D),P=i(25),C=i.n(P),T=i(26),V=i.n(T),F=i(27),_=i.n(F),j=i(28),k=i.n(j);function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function B(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t){return!t||"object"!==O(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function E(e){return(E=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var q=function(e){function r(e,t,i){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(n=L(this,E(r).call(this,{eventHub:{},store:c,router:{resize:function(){}},url:e,client:t,appData:i,appType:"DESKTOP",templateFunction:u.a}))).mainUniforms={colorBg:"#FFFFFF",colorDye:"#00007d",textureScale:.25,solveIterations:10,dissipation:.99,dyeDissipation:.98,velMultiplier:1.7,cellSize:32,mouseSize:.08,vorticity:!0,vorticityScale:.05},n}var t,i,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(r,s["a"]),t=r,(i=[{key:"setup",value:function(){var r=this;this.renderer=new a.u({canvas:document.querySelector("canvas"),antialias:!1,transparent:!0}),this.renderer.setClearColor(this.mainUniforms.colorBg),this.renderer.autoClear=!1,this.camera=new a.j(90,this.store.client.sizes.width/this.store.client.sizes.height,1e-4,1e3),this.camera.target=new a.s(0,0,0),this.camera.position.set(0,0,8),this.camera.lookAt(this.camera.target),this.scene=new a.o,this.mesh=new a.g(new a.k(2,2)),this.scene.add(this.mesh);var e=Math.floor(this.store.client.sizes.width*this.mainUniforms.textureScale),t=Math.floor(this.store.client.sizes.height*this.mainUniforms.textureScale);this.RtVel1=this.createRenderTarget(e,t),this.RtVel2=this.createRenderTarget(e,t),this.RtVel3=this.createRenderTarget(e,t),this.RtVel4=this.createRenderTarget(e,t,!0),this.RtDiv=this.createRenderTarget(e,t),this.RtPres1=this.createRenderTarget(e,t),this.RtPres2=this.createRenderTarget(e,t),this.RtCurl=this.createRenderTarget(e,t),this.RtDye1=this.createRenderTarget2(this.store.client.sizes.width,this.store.client.sizes.height),this.RtDye2=this.createRenderTarget2(this.store.client.sizes.width,this.store.client.sizes.height),this.advectVelocityMaterial=new a.n({uniforms:{velocity:{value:this.RtVel4.texture},target:{value:this.RtVel4.texture},texelSize:{value:new a.r(1/e,1/t)},aspectRatio:{value:e/t},iCellSize:{value:1/this.mainUniforms.cellSize},dissipation:{value:this.mainUniforms.dissipation},timeStep:{value:0}},vertexShader:S.a,fragmentShader:z.a}),this.forceMaterial=new a.n({uniforms:{velocity:{value:this.RtVel2.texture},velMultiplier:{value:this.mainUniforms.velMultiplier},texelSize:{value:new a.r(1/e,1/t)},aspectRatio:{value:e/t},timeStep:{value:0},cellSize:{value:this.mainUniforms.cellSize},mouseSize:{value:this.mainUniforms.mouseSize},mousePosition:{value:new a.r(0,0)},lastMousePosition:{value:new a.r(0,0)}},vertexShader:S.a,fragmentShader:w.a}),this.divergenceMaterial=new a.n({uniforms:{velocity:{value:this.RtVel1.texture},texelSize:{value:new a.r(1/e,1/t)},hICellSize:{value:1/this.mainUniforms.cellSize*.5},aspectRatio:{value:e/t}},vertexShader:S.a,fragmentShader:R.a}),this.solvePressureMaterial=new a.n({uniforms:{texelSize:{value:new a.r(1/e,1/t)},aspectRatio:{value:e/t},divergence:{value:this.RtDiv.texture},alpha:{value:-this.mainUniforms.cellSize*this.mainUniforms.cellSize},pressure:{value:null}},vertexShader:S.a,fragmentShader:U.a}),this.substractPressureMaterial=new a.n({uniforms:{texelSize:{value:new a.r(1/e,1/t)},aspectRatio:{value:e/t},pressure:{value:this.RtPres1.texture},velocity:{value:this.RtVel1.texture},iCellSize:{value:1/this.mainUniforms.cellSize}},vertexShader:S.a,fragmentShader:C.a}),this.calcCurlMaterial=new a.n({uniforms:{velocity:{value:null},texelSize:{value:new a.r(1/e,1/t)}},vertexShader:S.a,fragmentShader:V.a}),this.vorticityConfMaterial=new a.n({uniforms:{velocity:{value:null},curl:{value:null},texelSize:{value:new a.r(1/e,1/t)},vorticityScale:{value:this.mainUniforms.vorticityScale}},vertexShader:S.a,fragmentShader:_.a}),this.dyeMaterial=new a.n({uniforms:{dye:{value:this.RtDye1.texture},texelSize:{value:new a.r(1/e,1/t)},aspectRatio:{value:e/t},timeStep:{value:0},cellSize:{value:this.mainUniforms.cellSize},mouseSize:{value:this.mainUniforms.mouseSize},mousePosition:{value:new a.r(-1,1)},lastMousePosition:{value:new a.r(-1,1)}},vertexShader:S.a,fragmentShader:k.a}),this.advectDyeMaterial=new a.n({uniforms:{velocity:{value:this.RtVel4.texture},target:{value:this.RtDye2.texture},texelSize:{value:new a.r(1/e,1/t)},aspectRatio:{value:e/t},iCellSize:{value:1/this.mainUniforms.cellSize},dissipation:{value:this.mainUniforms.dyeDissipation},timeStep:{value:0}},vertexShader:S.a,fragmentShader:z.a}),this.effectComposerScene=new v.a(this.renderer),this.passFinal=new x(this.mainUniforms),this.effectComposerScene.addPass(this.passFinal.pass),this.createGui(),this.events.add(document,"mousemove",this.move,this),this.events.add(document,"touchmove",this.move,this);var o=performance.now()/1e3;this.firstMouseMove=!0,Object(l.a)(-1,function(){var e=performance.now()/1e3,t=e-o;o=e,r.advectVelocityMaterial.uniforms.timeStep.value=t,r.advectDyeMaterial.uniforms.timeStep.value=t,r.forceMaterial.uniforms.timeStep.value=t,r.dyeMaterial.uniforms.timeStep.value=t,r.doRender(r.advectVelocityMaterial,r.RtVel2),r.doRender(r.forceMaterial,r.RtVel1),r.forceMaterial.uniforms.lastMousePosition.value.copy(r.forceMaterial.uniforms.mousePosition.value),r.doRender(r.divergenceMaterial,r.RtDiv);for(var i=null,n=0;n<r.mainUniforms.solveIterations;n++)r.solvePressureMaterial.uniforms.pressure.value=r.RtPres1.texture,r.doRender(r.solvePressureMaterial,r.RtPres2),i=r.RtPres1,r.RtPres1=r.RtPres2,r.RtPres2=i;r.doRender(r.substractPressureMaterial,r.mainUniforms.vorticity?r.RtVel3:r.RtVel4),r.mainUniforms.vorticity&&(r.calcCurlMaterial.uniforms.velocity.value=r.RtVel3.texture,r.doRender(r.calcCurlMaterial,r.RtCurl),r.vorticityConfMaterial.uniforms.velocity.value=r.RtVel3.texture,r.vorticityConfMaterial.uniforms.curl.value=r.RtCurl.texture,r.doRender(r.vorticityConfMaterial,r.RtVel4)),r.dyeMaterial.uniforms.dye.value=r.RtDye1.texture,r.doRender(r.dyeMaterial,r.RtDye2),r.dyeMaterial.uniforms.lastMousePosition.value.copy(r.dyeMaterial.uniforms.mousePosition.value),r.doRender(r.advectDyeMaterial,r.RtDye1),r.passFinal.material.uniforms.tFluid.value=r.RtDye1.texture,r.effectComposerScene.render()})}},{key:"move",value:function(e){var t=e.targetTouches?e.targetTouches[0]:e;this.forceMaterial.uniforms.mousePosition.value.x=t.clientX/this.store.client.sizes.width*2-1,this.forceMaterial.uniforms.mousePosition.value.y=-1*(t.clientY/this.store.client.sizes.height*2-1),this.dyeMaterial.uniforms.mousePosition.value.copy(this.forceMaterial.uniforms.mousePosition.value),this.firstMouseMove&&(this.forceMaterial.uniforms.lastMousePosition.value.copy(this.forceMaterial.uniforms.mousePosition.value),this.dyeMaterial.uniforms.lastMousePosition.value.copy(this.dyeMaterial.uniforms.mousePosition.value),this.firstMouseMove=!1)}},{key:"doRender",value:function(e,t){this.mesh.material=e,this.renderer.render(this.scene,this.camera,t)}},{key:"createRenderTarget",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return new a.t(e,t,{wrapS:a.a,wrapT:a.a,minFilter:i?a.f:a.h,magFilter:i?a.f:a.h,format:a.m,type:/(iPad|iPhone|iPod)/g.test(navigator.userAgent)?a.e:a.d,stencilBuffer:!1,depthBuffer:!1})}},{key:"createRenderTarget2",value:function(e,t){return new a.t(e,t,{wrapS:a.a,wrapT:a.a,minFilter:a.f,magFilter:a.f,format:a.m,type:a.q,stencilBuffer:!1,depthBuffer:!1})}},{key:"createGui",value:function(){var t=this,e=new o.a,i=e.addFolder("Colors");i.closed=!1,i.addColor(this.mainUniforms,"colorBg").onChange(function(e){t.passFinal.material.uniforms.colorBg.value=new a.b(e)}),i.addColor(this.mainUniforms,"colorDye").onChange(function(e){t.passFinal.material.uniforms.colorDye.value=new a.b(e)});var n=e.addFolder("Simulation");n.closed=!1,n.add(this.mainUniforms,"textureScale",.01,1).onChange(function(e){t.resize()});n.add(this.mainUniforms,"solveIterations",1,60);n.add(this.mainUniforms,"dissipation",.95,.999).step(.001).onChange(function(e){t.advectVelocityMaterial.uniforms.dissipation.value=e}),n.add(this.mainUniforms,"dyeDissipation",.9,.995).step(.001).onChange(function(e){t.advectDyeMaterial.uniforms.dissipation.value=e}),n.add(this.mainUniforms,"velMultiplier",.1,3).step(.1).onChange(function(e){t.forceMaterial.uniforms.velMultiplier.value=e}),n.add(this.mainUniforms,"mouseSize",.001,.3).onChange(function(e){t.forceMaterial.uniforms.mouseSize.value=e,t.dyeMaterial.uniforms.mouseSize.value=e}),n.add(this.mainUniforms,"cellSize",1,64).step(1).onChange(function(e){t.advectVelocityMaterial.uniforms.iCellSize.value=1/e,t.advectDyeMaterial.uniforms.iCellSize.value=1/e,t.forceMaterial.uniforms.cellSize.value=e,t.dyeMaterial.uniforms.cellSize.value=e,t.divergenceMaterial.uniforms.hICellSize.value=1/e*.5,t.solvePressureMaterial.uniforms.alpha.value=-e*e,t.substractPressureMaterial.uniforms.iCellSize.value=1/e,t.resize()});n.add(this.mainUniforms,"vorticity");n.add(this.mainUniforms,"vorticityScale",.001,.25).step(.001).onChange(function(e){t.vorticityConfMaterial.uniforms.vorticityScale.value=e}),e.close()}},{key:"resize",value:function(e,t){if(this.renderer){if(this.camera.aspect=this.store.client.sizes.width/this.store.client.sizes.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.store.client.sizes.width,this.store.client.sizes.height),this.RtVel1){var i=Math.floor(this.store.client.sizes.width*this.mainUniforms.textureScale),n=Math.floor(this.store.client.sizes.height*this.mainUniforms.textureScale);this.RtVel1.setSize(i,n),this.RtVel2.setSize(i,n),this.RtVel3.setSize(i,n),this.RtVel4.setSize(i,n),this.RtDiv.setSize(i,n),this.RtPres1.setSize(i,n),this.RtPres2.setSize(i,n),this.RtCurl.setSize(i,n),this.RtDye1.setSize(this.store.client.sizes.width,this.store.client.sizes.height),this.RtDye2.setSize(this.store.client.sizes.width,this.store.client.sizes.height),this.advectVelocityMaterial.uniforms.texelSize.value.x=1/i,this.advectVelocityMaterial.uniforms.texelSize.value.y=1/n,this.advectVelocityMaterial.uniforms.aspectRatio.value=i/n,this.forceMaterial.uniforms.texelSize.value.x=1/i,this.forceMaterial.uniforms.texelSize.value.y=1/n,this.forceMaterial.uniforms.aspectRatio.value=i/n,this.divergenceMaterial.uniforms.texelSize.value.x=1/i,this.divergenceMaterial.uniforms.texelSize.value.y=1/n,this.divergenceMaterial.uniforms.aspectRatio.value=i/n,this.solvePressureMaterial.uniforms.texelSize.value.x=1/i,this.solvePressureMaterial.uniforms.texelSize.value.y=1/n,this.solvePressureMaterial.uniforms.aspectRatio.value=i/n,this.substractPressureMaterial.uniforms.texelSize.value.x=1/i,this.substractPressureMaterial.uniforms.texelSize.value.y=1/n,this.substractPressureMaterial.uniforms.aspectRatio.value=i/n,this.calcCurlMaterial.uniforms.texelSize.value.x=1/i,this.calcCurlMaterial.uniforms.texelSize.value.y=1/n,this.vorticityConfMaterial.uniforms.texelSize.value.x=1/i,this.vorticityConfMaterial.uniforms.texelSize.value.y=1/n,this.dyeMaterial.uniforms.texelSize.value.x=1/i,this.dyeMaterial.uniforms.texelSize.value.y=1/n,this.dyeMaterial.uniforms.aspectRatio.value=i/n,this.advectDyeMaterial.uniforms.texelSize.value.x=1/i,this.advectDyeMaterial.uniforms.texelSize.value.y=1/n,this.advectDyeMaterial.uniforms.aspectRatio.value=i/n}this.effectComposerScene&&this.effectComposerScene.setSize(this.store.client.sizes.width,this.store.client.sizes.height)}}}])&&B(t.prototype,i),n&&B(t,n),r}();function A(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var H=window.location.protocol+"//"+window.location.host,G={lang:"",os:"",device:"",browser:""},J=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.detectOS(),this.detectDevice(),this.addClasses(),this.initApp(),this.sayHello()}var t,i,n;return t=e,(i=[{key:"detectOS",value:function(){!0===r.a.mac?G.os="mac":!0===r.a.ios?G.os="ios":G.os="windows"}},{key:"detectDevice",value:function(){if(r.a.mobile||r.a.tablet)G.device=r.a.mobile?"mobile":"tablet";else switch(G.device="desktop",r.a.name){case"Internet Explorer":G.browser="explorer";break;case"Microsoft Edge":G.browser="edge";break;case"Firefox":G.browser="firefox";break;case"Safari":G.browser="safari";break;default:G.browser="chrome"}}},{key:"addClasses",value:function(){var e=document.querySelector("html");for(var t in G)G[t]&&e.classList.add(G[t])}},{key:"initApp",value:function(e){new q(H,G,{}).render()}},{key:"sayHello",value:function(){if("Chrome"===r.a.name||"Firefox"===r.a.name){window.console.log.apply(console,["%c Developed by @vlucendo - http://vlucendo.com ","display: block; padding: 5px; background: #351330; line-height: 40px; color: #ffffff;"])}else window.console.log("Developed by @vlucendo - http://vlucendo.com")}}])&&A(t.prototype,i),n&&A(t,n),e}();"loading"!==document.readyState?new J:document.addEventListener("DOMContentLoaded",function(){new J},!1)}]);